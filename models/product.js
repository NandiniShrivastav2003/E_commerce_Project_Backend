const mongoose = require('mongoose');
const Review = require('./review');

const productSchema = new mongoose.Schema({
    name: {
        type: String,
        trim: true,
        required: true
    },
    img: {
        type: String,
        trim: true,
        default: 'data:image/png;base64,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'
    },
    // price: {
    //     type: Number,
    //     min: 0,
    //     default: 0
    // },
    desc: {
        type: String,
        trim: true
    },
    avgRating: {
        type: Number,
        default:0 
    },
    author: {
        type: mongoose.Schema.Types.ObjectId,
        ref:'User'
    },
    reviews: [
        {
            type: mongoose.Schema.Types.ObjectId,
            ref:'Review'
        }
    ]
});



// Mongoose middleware function to delete all the associated reviews on a product
productSchema.post('findOneAndDelete',async function(product) {
    if (product.reviews.length > 0) {
        await Review.deleteMany({ _id: { $in: product.reviews } });
    }
});

const Product = mongoose.model('Product', productSchema);

module.exports = Product;